{{ $site := .site }}
{{ $theme := resources.Match "model/script/critical/**.css" | resources.Concat "_tmp/scripts/head-theme.css" }}
{{ $based := resources.Match "_core/script/critical/**.css" | resources.Concat "_tmp/scripts/head-based.css" }}


{{ $bundle := slice $based $theme | resources.Concat "_tmp/scripts/critical.css" }}

{{- if eq hugo.Environment "development" }}
    {{- with $bundle | fingerprint }}
        {{- $src := .Content | safeCSS }}
        <style id="{{ $site.Params.theme }}-script-critical" rel="stylesheet" integrity="{{ .Data.Integrity }}" crossorigin="anonymous">{{ $src }}</style>
    {{ end }}
{{ else }}
    {{- with $bundle | minify | fingerprint }}
        {{- $src := .Content | safeCSS }}
        <style id="{{ $site.Params.theme }}-script-critical" rel="stylesheet" integrity="{{ .Data.Integrity }}" crossorigin="anonymous">{{ $src }}</style>
    {{- end }}
{{ end }}