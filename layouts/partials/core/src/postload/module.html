{{ $site := .site }}
{{ $theme := resources.Match "model/script/module/defers/**.js" | resources.Concat "_tmp/scripts/foot-module-theme.js" }}
{{ $based := resources.Match "_core/script/module/defers/**.js" | resources.Concat "_tmp/scripts/foot-module-based.js" }}


{{ $bundle := slice $based $theme  | resources.Concat "static/scripts/foot-module.js" }}

{{- if eq hugo.Environment "development" }}
    {{- with $bundle | js.Build | fingerprint }}
        <script id="{{ $site.Params.theme }}-module-critical" type="module" src="{{ .RelPermalink }}" integrity="{{- .Data.Integrity }}" crossorigin="anonymous"></script>
    {{- end }}
{{ else }}
    {{- $opts := dict "minify" true }}
    {{- with $bundle | js.Build $opts | fingerprint }}
        <script id="{{ $site.Params.theme }}-module-critical" type="module" src="{{ .RelPermalink }}" integrity="{{- .Data.Integrity }}" crossorigin="anonymous"></script>
    {{- end }}
{{ end }}