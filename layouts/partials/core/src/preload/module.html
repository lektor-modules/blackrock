{{ $site := .site }}
{{ $theme := resources.Match "model/script/module/critical/**.js" | resources.Concat "_tmp/scripts/head-module-theme-critical.js" }}
{{ $based := resources.Match "_core/script/module/critical/**.js" | resources.Concat "_tmp/scripts/head-module-based-critical.js" }}


{{ $bundle := slice $based $theme  | resources.Concat "static/scripts/head-module.js" }}

{{- if eq hugo.Environment "development" }}
    {{- with $bundle | js.Build }}
        {{- $src := .Content | safeJS }}
        <script id="{{ $site.Params.theme }}-module-critical" type="module" integrity="{{- .Data.Integrity }}" crossorigin="anonymous">{{ $src }}</script>
    {{- end }}
{{ else }}
    {{- $opts := dict "minify" true }}
    {{- with $bundle | js.Build $opts | fingerprint }}
        {{- $src := .Content | safeJS }}
        <script id="{{ $site.Params.theme }}-module-critical" type="module" integrity="{{- .Data.Integrity }}" crossorigin="anonymous">{{ $src }}</script>
    {{- end }}
{{ end }}